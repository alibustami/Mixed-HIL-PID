flowchart LR
    START([User Prefers DE])
    
    START --> PREF[Update Preference Model<br/>weights += 0.3 × DE_normalized - weights]
    
    PREF --> ANCHOR[Generate Anchor Point<br/>anchor = min + weights × max - min]
    
    ANCHOR --> DE_ACT[DE Actions]
    DE_ACT --> DE1[Reset mutation = 0.5]
    DE1 --> DE2[Inject anchor into population<br/>protect best individual]
    
    ANCHOR --> BO_ACT[BO Actions]
    BO_ACT --> BO1{DE feasible?}
    BO1 -->|Yes| BO2[Preference Nudge<br/>pseudo_cost = fit_A - 0.2×gap<br/>Update GP with lower cost]
    BO1 -->|No| BO3[Skip nudge]
    
    DE2 --> END([Continue Optimization])
    BO2 --> END
    BO3 --> END
    
    classDef prefStyle fill:#FFF4E6,stroke:#FF8C00,stroke-width:2px
    classDef deStyle fill:#CCE6FF,stroke:#0066CC,stroke-width:2px
    classDef boStyle fill:#E6CCFF,stroke:#9933CC,stroke-width:2px
    classDef endStyle fill:#D5F5E3,stroke:#27AE60,stroke-width:2px
    
    class START,PREF,ANCHOR prefStyle
    class DE_ACT,DE1,DE2 deStyle
    class BO_ACT,BO1,BO2,BO3 boStyle
    class END endStyle
